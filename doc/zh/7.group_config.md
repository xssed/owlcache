[<p align="right">->返回目录</p>](0.directory.md)

# 集群配置  
>⚠⚠⚠在添加和修改数据时，建议遵循HTTP协议，并使用专业客户端进行后期提交，以避免传输编码导致数据不一致。这只是一个示范。  

* HTTP
注意:所有集群配置相关的操作都需要验证身份。

## 获取集群中所有节点  

<table>
    <tr>
        <td>请求参数</td>
        <td>参数值</td>
    </tr>
    <tr>
        <td>group_type</td>
        <td>owlcache</td>
    </tr>
    <tr>
        <td>cmd</td>
        <td>getall</td>
    </tr>
    <tr>
        <td>token</td>
        <td>token值</td>
    </tr> 
</table> 
 
~~~shell
http://127.0.0.1:7721/server/?cmd=getall&group_type=owlcache&token=MDZhZDYzYzZkOTYwYjM3YTFlY2M0NTVhZWZjMzJkNmU=
~~~
<br>

响应结果例子:
~~~shell
{
    "Cmd": "getall",
    "Status": 200,
    "Results": "SUCCESS",
    "Address": "",
    "Data": [
        {
            "Cmd": "",
            "Address": "127.0.0.1:7721",
            "Pass": "",
            "Token": ""
        },
        {
            "Cmd": "",
            "Address": "127.0.0.1:7723",
            "Pass": "",
            "Token": ""
        },
        {
            "Cmd": "",
            "Address": "127.0.0.1:7725",
            "Pass": "",
            "Token": ""
        }
    ]
}
~~~


## 获取集群中一个节点的配置信息  

<table>
    <tr>
        <td>请求参数</td>
        <td>参数值</td>
    </tr>
    <tr>
        <td>group_type</td>
        <td>owlcache</td>
    </tr>
    <tr>
        <td>cmd</td>
        <td>get</td>
    </tr>
    <tr>
        <td>address</td>
        <td>节点地址</td>
    </tr> 
    <tr>
        <td>token</td>
        <td>token值</td>
    </tr> 
</table> 
 
~~~shell
http://127.0.0.1:7721/server/?cmd=get&group_type=owlcache&address=127.0.0.1:7721&token=MDZhZDYzYzZkOTYwYjM3YTFlY2M0NTVhZWZjMzJkNmU=
~~~
<br>

响应结果例子:
~~~shell
{
    "Cmd": "get",
    "Status": 200,
    "Results": "SUCCESS",
    "Address": "127.0.0.1:7721",
    "Data": {
        "Cmd": "",
        "Address": "127.0.0.1:7721",
        "Pass": "",
        "Token": ""
    }
}
~~~  

## 增加一个节点的配置信息  

<table>
    <tr>
        <td>请求参数</td>
        <td>参数值</td>
    </tr>
    <tr>
        <td>group_type</td>
        <td>owlcache</td>
    </tr>
    <tr>
        <td>cmd</td>
        <td>add</td>
    </tr>
    <tr>
        <td>address</td>
        <td>节点地址</td>
    </tr> 
    <tr>
        <td>pass</td>
        <td>节点的连接密码</td>
    </tr> 
    <tr>
        <td>token</td>
        <td>token值</td>
    </tr> 
</table> 
 
~~~shell
http://127.0.0.1:7721/server/?cmd=add&group_type=owlcache&address=127.0.0.1:8080&pass=shi!jie9he?ping6&token=MDZhZDYzYzZkOTYwYjM3YTFlY2M0NTVhZWZjMzJkNmU=
~~~
<br>

响应结果例子:
~~~shell
{
    "Cmd": "",
    "Status": 200,
    "Results": "SUCCESS",
    "Address": "127.0.0.1:8080",
    "Data": null
}
~~~

## 删除一个节点的配置信息  

<table>
    <tr>
        <td>请求参数</td>
        <td>参数值</td>
    </tr>
    <tr>
        <td>group_type</td>
        <td>owlcache</td>
    </tr>
    <tr>
        <td>cmd</td>
        <td>delete</td>
    </tr>
    <tr>
        <td>address</td>
        <td>节点地址</td>
    </tr> 
    <tr>
        <td>token</td>
        <td>token值</td>
    </tr> 
</table> 
 
~~~shell
http://127.0.0.1:7721/server/?cmd=delete&group_type=owlcache&address=127.0.0.1:8080&token=MDZhZDYzYzZkOTYwYjM3YTFlY2M0NTVhZWZjMzJkNmU=
~~~
<br>

响应结果例子:
~~~shell
{
    "Cmd": "delete",
    "Status": 200,
    "Results": "SUCCESS",
    "Address": "127.0.0.1:8080",
    "Data": null
}
~~~  
如果你觉得通过HTTP协议配置很麻烦，你可以直接编辑文件`server_group_config.json`。在owlcache启动时，集群配置信息会被加载。


# 集群数据同步配置  
* owlcache采用Gossip协议来实现集群间的数据同步,作者认为松散的同步会让集群效率更高。
* Gossip协议是一个数据最终一致性的解决方案。
* 需要在启动时就配置好集群信息，但是配置轻松简单。
* 每个节点的数据会自动更新到最新，虽然有延时，但是时间很短。  
  

>下面我们演示如何配置Gossip数据交换集群。假设现在计划运行三个Owlcache Gossip服务:127.0.0.1:7726、127.0.0.1:7727、127.0.0.1:7728。<br>
(1)把owlcache.conf文件中的GroupDataSync选项设置为1，开启服务<br>
(2)把三个服务的owlcache.conf文件中的Gossipport选项分别为`7726`、`7727`、`7728`<br>
(3)Gossip服务集群时,节点进行数据交换是需要认证身份的。需要把三个owlcache.conf文件中的<GossipDataSyncAuthKey>选项值设置为统一的密码。<br>
(4)手工编写Gossip服务集群配置文件 `server_group_gossip_config.json`<br>
~~~shell
[
	{
		"Cmd": "",
		"Address": "127.0.0.1:7726",
		"Pass": "",
		"Token": ""
	},
	{
		"Cmd": "",
		"Address": "127.0.0.1:7727",
		"Pass": "",
		"Token": ""
	},
	{
		"Cmd": "",
		"Address": "127.0.0.1:7728",
		"Pass": "",
		"Token": ""
	}
]
~~~  
(5)将 `server_group_gossip_config.json` 文件放入数据文件目录(取决于配置文件中DBfile选项的设置)，然后启动节点。 
这样集群就配置好了，在owlcache启动时，集群配置信息会被加载。节点之间会自动联系，假设现在节点一宕机，节点二与节点三仍然会保持通讯，更新数据。  

>☆☆☆当然你也可以通过HTTP协议配置Gossip集群。参照集群配置信息，将HTTP请求字段group_type修改为gossip  
